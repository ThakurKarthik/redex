<!DOCTYPE html>
<html lang="en" data-theme="">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<script type="text/javascript">/*<![CDATA[*/window.__chunkMapping={"main":["/redex/main.af51655e7685a542f2e8.css","/redex/main.f76a4162e62a241c4b5b.js"],"component---site-src-pages-faq-jsa-48-8a3":["/redex/component---site-src-pages-faq-jsa-48-8a3.ed79ae669411c34b9545.js"],"component---site-src-pages-index-jsece-a18":["/redex/component---site-src-pages-index-jsece-a18.8b4250f28cce950c7dc2.css","/redex/component---site-src-pages-index-jsece-a18.8748e5432ed6082d27cf.js"],"component---theme-doc-page-1-be-9be":[],"docsMetadata---redex-docse-2-f-64f":["/redex/docsMetadata---redex-docse-2-f-64f.1bd9ae6afe1721cb889b.js"],"component---theme-doc-item-178-a40":["/redex/component---theme-doc-item-178-a40.de2648345892298aff25.css","/redex/component---theme-doc-item-178-a40.333f56bb711e4da78ba6.js"],"content---redex-docs-faqf-0-e-3d3":["/redex/content---redex-docs-faqf-0-e-3d3.9f263f02d230de3a57dc.js"],"metadata---redex-docs-faq-78-f-205":["/redex/metadata---redex-docs-faq-78-f-205.5a5df0ad6f4d4c266636.js"],"content---redex-docs-docker-803-518":["/redex/content---redex-docs-docker-803-518.eb52c54658fa86d80cc0.js"],"metadata---redex-docs-dockerd-2-b-96b":["/redex/metadata---redex-docs-dockerd-2-b-96b.bf7dede69f2f8df14556.js"],"content---redex-docs-buck-227-a8d":["/redex/content---redex-docs-buck-227-a8d.dc614273f7bcaa0de763.js"],"metadata---redex-docs-buckcf-2-901":["/redex/metadata---redex-docs-buckcf-2-901.907a2c30219ee52f10d7.js"],"content---redex-docs-configuring-13-a-322":["/redex/content---redex-docs-configuring-13-a-322.b7aac2f5311f8c51fbc2.js"],"metadata---redex-docs-configuring-67-a-4d6":["/redex/metadata---redex-docs-configuring-67-a-4d6.3606ff1f30ad0d9843d8.js"],"content---redex-docs-interdex-550-886":["/redex/content---redex-docs-interdex-550-886.0e1ab8717b7c28651f48.js"],"metadata---redex-docs-interdexcdc-d44":["/redex/metadata---redex-docs-interdexcdc-d44.43c59a724d5a86f18753.js"],"content---redex-docs-installation-5-fd-caf":["/redex/content---redex-docs-installation-5-fd-caf.32adc82cede47f50bc6b.js"],"metadata---redex-docs-installation-30-a-603":["/redex/metadata---redex-docs-installation-30-a-603.6ea187f8f191a17c26cc.js"],"content---redex-docs-proguard-481-913":["/redex/content---redex-docs-proguard-481-913.49965fa1d0a92c20c99c.js"],"metadata---redex-docs-proguard-66-d-171":["/redex/metadata---redex-docs-proguard-66-d-171.e5721dd1974aabc4256f.js"],"content---redex-docs-synth-925-331":["/redex/content---redex-docs-synth-925-331.80d465a3a9caab2e8a5f.js"],"metadata---redex-docs-synth-885-2c0":["/redex/metadata---redex-docs-synth-885-2c0.c9bd712c298a5700f111.js"],"content---redex-docs-usage-545-444":["/redex/content---redex-docs-usage-545-444.f4e9421ce3e110b045b1.js"],"metadata---redex-docs-usagec-7-d-5cf":["/redex/metadata---redex-docs-usagec-7-d-5cf.a7167950eb559deaedb8.js"]};/*]]>*/</script>

<title data-react-helmet="true">Redex Synth Pass Example</title>

<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="viewport" content="width=device-width"/><meta data-react-helmet="true" property="og:title" content="Redex · An Android Bytecode Optimizer"/><meta data-react-helmet="true" property="og:image" content="https://ThakurKarthik.github.io/redex/img/og_image.png"/><meta data-react-helmet="true" property="twitter:image" content="https://ThakurKarthik.github.io/redex/img/og_image.png"/><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Redex · An Android Bytecode Optimizer"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="description" content="&gt; The code and artifacts for this example are on [GitHub](https://github.com/facebook/redex/tree/master/examples/Synth)."/><meta data-react-helmet="true" property="og:description" content="&gt; The code and artifacts for this example are on [GitHub](https://github.com/facebook/redex/tree/master/examples/Synth)."/><meta data-react-helmet="true" property="og:url" content="https://ThakurKarthik.github.io/redex/docs/synth"/>

<link data-react-helmet="true" rel="shortcut icon" href="/redex/img/favicon.png"/>


<link rel="stylesheet" type="text/css" href="/redex/main.af51655e7685a542f2e8.css" />

<link rel="stylesheet" type="text/css" href="/redex/0.4b6b47aa5e3c93eeb1e7.css" />

<link rel="stylesheet" type="text/css" href="/redex/25.83fe3ec1d8a1843e16c8.css" />

<link rel="stylesheet" type="text/css" href="/redex/component---theme-doc-item-178-a40.de2648345892298aff25.css" />

</head>
<body >
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/redex/"><img class="navbar__logo" src="/redex/img/favicon.png" alt="Redex Logo"/><strong class="">Redex</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" label="Docs" position="right" href="/redex/docs/installation">Docs</a><a class="navbar__item navbar__link" label="FAQ" position="right" href="/redex/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="https://code.facebook.com/posts/1480969635539475/optimizing-android-bytecode-with-redex" label="Birth" position="right" target="_blank" rel="noopener noreferrer">Birth</a><div class="react-toggle displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_16vC moon_1N64"></span></div><div class="react-toggle-track-x"><span class="toggle_16vC sun_3CZP"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"/></div></div></div><div role="presentation" class="navbar__sidebar__backdrop"></div><div class="navbar__sidebar"><div class="navbar__sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/redex/"><img class="navbar__logo" src="/redex/img/favicon.png" alt="Redex Logo"/><strong>Redex</strong></a></div><div class="navbar__sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" label="Docs" position="right" href="/redex/docs/installation">Docs</a></li><li class="menu__list-item"><a class="menu__link" label="FAQ" position="right" href="/redex/docs/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" href="https://code.facebook.com/posts/1480969635539475/optimizing-android-bytecode-with-redex" label="Birth" position="right" target="_blank" rel="noopener noreferrer">Birth</a></li></ul></div></div></div></nav><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/redex/docs/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/redex/docs/configuring">Configuring ReDex</a></li><li class="menu__list-item"><a class="menu__link" href="/redex/docs/usage">Usage</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Examples</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/redex/docs/proguard">Using ProGuard Rules with Redex</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/redex/docs/synth">Redex Synth Pass Example</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Technical Details</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/redex/docs/docker">Docker Container Deployments</a></li><li class="menu__list-item"><a class="menu__link" href="/redex/docs/interdex">Interdex</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Help</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/redex/docs/faq">FAQ</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col"><div class="docItemContainer_2cwg"><header><h1 class="docTitle_1vWb">Redex Synth Pass Example</h1></header><article><div class="markdown"><blockquote><p>The code and artifacts for this example are on <a href="https://github.com/facebook/redex/tree/master/examples/Synth">GitHub</a>.</p></blockquote><p>The synth optimizations attempt to remove synthetic methods and wrappers. This
improves performance by making access to field values faster and it also
reduces code size because the definition and invocation of synthetic methods
is eliminated.</p><h2><a aria-hidden="true" class="anchor" id="removing-synthetic-methods-for-accessing-static-fields"></a><a aria-hidden="true" class="hash-link" href="#removing-synthetic-methods-for-accessing-static-fields">#</a>Removing synthetic methods for accessing static fields</h2><p>This directory contains an Android Studio 1.5 project that illustrates how a
wrapper synthetic method is removed by Redex. The contrived example is
a simple Android application which makes use of this class:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-java codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214)">com</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">facebook</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">redex</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">examples</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">synth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Alpha</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> alpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Alpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> initialValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        alpha </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> initialValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Beta</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">doubleAlpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> alpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>The key thing to note here is that there is an inner class <code>Beta</code> which
has a method <code>doubleAlpha</code> which accesses a private static field <code>alpha</code> of
its outer class <code>Alpha</code>. A dump of the Dex bytecode for the <code>Alpha</code> class
confirms that the <code>alpha</code> field is <code>private</code> and <code>static</code>.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Static fields     -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #0              : (in Lcom/facebook/redex/examples/synth/Alpha;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name          : &#x27;alpha&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      type          : &#x27;I&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      access        : 0x000a (PRIVATE STATIC)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>Java compilers will implement accesses] to this field from inner classes
by generating a synthetic getter method to allow the inner class to access
the private field of the outer
class. We can see the automatically generated synthetic method <code>access$000</code>
if we examine the Dex bytecode for the <code>Alpha</code> class:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Class #597            -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Class descriptor  : &#x27;Lcom/facebook/redex/examples/synth/Alpha;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #1              : (in Lcom/facebook/redex/examples/synth/Alpha;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name          : &#x27;access$000&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      type          : &#x27;()I&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      access        : 0x1008 (STATIC SYNTHETIC)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      code          -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      registers     : 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ins           : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      outs          : 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      insns size    : 3 16-bit code units</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">065f14:                                        |[065f14] com.facebook.redex.examples.synth.Alpha.access$000:()I</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">065f24: 6000 070b                              |0000: sget v0, Lcom/facebook/redex/examples/synth/Alpha;.alpha:I // field@0b07</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">065f28: 0f00                                   |0002: return v0</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>This generated synthetic method can be accessed by the inner class
which keeps the JVM happy. All it does is to read the state field
value using an <code>sget</code> instruction and return the read value.
This synthetic wrapper is used in the implementation of <code>doubleAlpha</code>:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Virtual methods   -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #0              : (in Lcom/facebook/redex/examples/synth/Alpha$Beta;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name          : &#x27;doubleAlpha&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">065ed8:                                        |[065ed8] com.facebook.redex.examples.synth.Alpha.Beta.doubleAlpha:()I</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">065ee8: 7100 1118 0000                         |0000: invoke-static {}, Lcom/facebook/redex/examples/synth/Alpha;.access$000:()I // method@1811</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">065eee: 0a00                                   |0003: move-result v0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">065ef0: da00 0002                              |0004: mul-int/lit8 v0, v0, #int 2 // #02</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">065ef4: 0f00                                   |0006: return v0</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>For the <code>doubleAlpha</code> method in the inner class <code>Beta</code> to access the
private static field of the enclosing class an <code>invoke-static</code> call is made
to the synthetic wrapper method <code>access$000</code>.</p><p>Here is an example of the <code>doubleAlpha</code> method being used from a simple
Android application:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-java codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">package</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214)">com</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">facebook</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">redex</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">examples</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">synth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214)">android</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">support</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">v7</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">AppCompatActivity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214)">android</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Bundle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214)">android</span><span class="token namespace punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token namespace" style="color:rgb(178, 204, 214)">widget</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">TextView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MainActivity</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AppCompatActivity</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">protected</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">onCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Bundle</span><span class="token plain"> savedInstanceState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">super</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">onCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">savedInstanceState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">setContentView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">R</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">layout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">activity_main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">TextView</span><span class="token plain"> textView </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">TextView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">findViewById</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">R</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        textView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setText</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Redex Synth Example\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">Alpha</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Alpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">Alpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Beta</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Beta</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        textView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">append</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Double Alpha(12) = &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">doubleAlpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>If we examined the Dex bytecode for the call to <code>doubleAlpha</code> we would
see something like this which shows a virtual call to the <code>doubleAlpha</code> method:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Direct methods    -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #0              : (in Lcom/facebook/redex/examples/synth/MainActivity;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name          : &#x27;onCreate&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">065fb6: 6e10 0f18 0100                         |0031: invoke-virtual {v1}, Lcom/facebook/redex/examples/synth/Alpha$Beta;.doubleAlpha:()I // method@180f</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>After running Redex the synthetic wrapper method will be removed and
the code for accessing the <code>alpha</code> static field will be inlined into
the code for the main activity:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Direct methods    -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #0              : (in Lcom/facebook/redex/examples/synth/MainActivity;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name          : &#x27;onCreate&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">07f246: 6005 4d06                              |0031: sget v5, Lcom/facebook/redex/examples/synth/Alpha;.alpha:I // field@064d</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">07f24a: da05 0502                              |0033: mul-int/lit8 v5, v5, #int 2 // #02</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>To make the access of the <code>alpha</code> field legal for the Dalvik VM we have
mutated the access permissions for this field:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Static fields     -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #0              : (in Lcom/facebook/redex/examples/synth/Alpha;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name          : &#x27;alpha&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      type          : &#x27;I&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      access        : 0x0009 (PUBLIC STATIC)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><p>Similar optimizations exist for other synthetic wrapper scenarios e.g.
for instance fields.</p><h2><a aria-hidden="true" class="anchor" id="example-code"></a><a aria-hidden="true" class="hash-link" href="#example-code">#</a>Example Code</h2><p>The project in the <code>synth-example</code> directory can be opened with Android Studio 1.5 and
contains the sample here that illustrates the removal of synthetic
wrappers for static private fields. </p><p>The <code>Makefile</code> in this directory can be used once you have build a signed:
APK (<code>Build : Generate Signed APK...</code>) to produce the following items:</p><ul><li><code>synth-example-release-redex.apk</code>: A Redex optimized version of the original APK.</li><li><code>classes.dump</code>: A dump of the Dex bytecode for the input APK <code>synth-example-release.apk</code>.</li><li><code>classes-redex.dump</code>: A dump of the Redex optimizd APK <code>synth-example-release-redex.apk</code>.</li></ul><p>The environment variable <code>ANDROID_TOOLS</code> should be set to the location
of your Android SDK tools directory.</p><p>To produce these items:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-undefined codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ make clean all</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated<!-- --> <!-- -->on<!-- --> <strong>2/27/2019</strong> <!-- -->by <strong>Jez Ng</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/redex/docs/proguard"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« <!-- -->Using ProGuard Rules with Redex</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/redex/docs/docker"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Docker Container Deployments<!-- --> »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#removing-synthetic-methods-for-accessing-static-fields" class="contents__link">Removing synthetic methods for accessing static fields</a></li><li><a href="#example-code" class="contents__link">Example Code</a></li></ul></div></div></div></div></div></div></main></div>
</div>

<script type="text/javascript" src="/redex/runtime~main.6c0e065f3d23e7a6667e.js"></script>

<script type="text/javascript" src="/redex/main.f76a4162e62a241c4b5b.js"></script>

<script type="text/javascript" src="/redex/0.2a4b78709cde38bbddb9.js"></script>

<script type="text/javascript" src="/redex/25.446984d9ff9b218b6ac4.js"></script>

<script type="text/javascript" src="/redex/docsMetadata---redex-docse-2-f-64f.1bd9ae6afe1721cb889b.js"></script>

<script type="text/javascript" src="/redex/component---theme-doc-item-178-a40.333f56bb711e4da78ba6.js"></script>

<script type="text/javascript" src="/redex/content---redex-docs-synth-925-331.80d465a3a9caab2e8a5f.js"></script>

<script type="text/javascript" src="/redex/metadata---redex-docs-synth-885-2c0.c9bd712c298a5700f111.js"></script>

</body>
</html>